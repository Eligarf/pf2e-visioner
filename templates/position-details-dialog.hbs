{{!--
  Position Details Dialog Template
  Shows detailed position analysis for a specific token pair
--}}

<div class="position-details-content">
  {{!-- Header with token information --}}
  <div class="position-details-header">
    <div class="token-pair-info">
      <div class="sneaker-info">
        <img src="{{sneaker.image}}" width="32" height="32" />
        <span class="token-name">{{sneaker.name}}</span>
        <span class="role-label">Sneaking</span>
      </div>
      <div class="vs-indicator">
        <i class="fas fa-eye"></i>
      </div>
      <div class="observer-info">
        <img src="{{observer.image}}" width="32" height="32" />
        <span class="token-name">{{observer.name}}</span>
        <span class="role-label">Observer</span>
      </div>
    </div>
    
    {{#if positionTransition.hasChanged}}
      <div class="transition-summary {{positionTransition.transitionType}}">
        {{{positionTransitionIcon positionTransition}}}
        <span class="transition-text">{{positionTransitionSummary positionTransition}}</span>
      </div>
    {{/if}}
  </div>

  {{!-- Position Comparison --}}
  <div class="position-comparison">
    <div class="position-column start-position">
      <h3>
        <i class="fas fa-play"></i>
        Start Position
      </h3>
      <div class="position-stats">
        <div class="stat-row">
          <span class="stat-label">Visibility State:</span>
          <span class="stat-value">
            {{{visibilityStateIndicator startPosition.avsVisibility}}}
            {{startPosition.avsVisibility}}
          </span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Cover State:</span>
          <span class="stat-value">
            {{{coverStateIndicator startPosition.coverState}}}
            {{startPosition.coverState}}
          </span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Stealth Bonus:</span>
          <span class="stat-value">+{{startPosition.stealthBonus}}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Distance:</span>
          <span class="stat-value">{{startPosition.distance}} ft</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Line of Sight:</span>
          <span class="stat-value">
            {{#if startPosition.hasLineOfSight}}
              <i class="fas fa-check" style="color: #28a745;"></i> Yes
            {{else}}
              <i class="fas fa-times" style="color: #dc3545;"></i> No
            {{/if}}
          </span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Lighting:</span>
          <span class="stat-value">{{startPosition.lightingConditions}}</span>
        </div>
      </div>
    </div>

    <div class="position-arrow">
      {{#if positionTransition.hasChanged}}
        <i class="fas fa-arrow-right {{positionTransition.transitionType}}"></i>
      {{else}}
        <i class="fas fa-equals position-unchanged"></i>
      {{/if}}
    </div>

    <div class="position-column end-position">
      <h3>
        <i class="fas fa-stop"></i>
        End Position
      </h3>
      <div class="position-stats">
        <div class="stat-row">
          <span class="stat-label">Visibility State:</span>
          <span class="stat-value">
            {{{visibilityStateIndicator endPosition.avsVisibility}}}
            {{endPosition.avsVisibility}}
            {{#if positionTransition.avsVisibilityChanged}}
              <span class="change-indicator">
                <i class="fas fa-exclamation-triangle"></i>
              </span>
            {{/if}}
          </span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Cover State:</span>
          <span class="stat-value">
            {{{coverStateIndicator endPosition.coverState}}}
            {{endPosition.coverState}}
            {{#if positionTransition.coverStateChanged}}
              <span class="change-indicator">
                <i class="fas fa-exclamation-triangle"></i>
              </span>
            {{/if}}
          </span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Stealth Bonus:</span>
          <span class="stat-value">
            +{{endPosition.stealthBonus}}
            {{#if (gt positionTransition.stealthBonusChange 0)}}
              {{{stealthBonusChange positionTransition.stealthBonusChange}}}
            {{else if (lt positionTransition.stealthBonusChange 0)}}
              {{{stealthBonusChange positionTransition.stealthBonusChange}}}
            {{/if}}
          </span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Distance:</span>
          <span class="stat-value">{{endPosition.distance}} ft</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Line of Sight:</span>
          <span class="stat-value">
            {{#if endPosition.hasLineOfSight}}
              <i class="fas fa-check" style="color: #28a745;"></i> Yes
            {{else}}
              <i class="fas fa-times" style="color: #dc3545;"></i> No
            {{/if}}
          </span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Lighting:</span>
          <span class="stat-value">{{endPosition.lightingConditions}}</span>
        </div>
      </div>
    </div>
  </div>

  {{!-- Position Impact Summary --}}
  {{#if positionTransition.hasChanged}}
    <div class="position-impact-summary">
      <h3>
        <i class="fas fa-chart-line"></i>
        Position Impact Analysis
      </h3>
      <div class="impact-stats">
        <div class="impact-row">
          <span class="impact-label">DC Modification:</span>
          <span class="impact-value {{#if (gt positionTransition.impactOnDC 0)}}positive{{else if (lt positionTransition.impactOnDC 0)}}negative{{else}}neutral{{/if}}">
            {{#if (gt positionTransition.impactOnDC 0)}}+{{/if}}{{positionTransition.impactOnDC}}
          </span>
        </div>
        <div class="impact-row">
          <span class="impact-label">Stealth Bonus Change:</span>
          <span class="impact-value {{#if (gt positionTransition.stealthBonusChange 0)}}positive{{else if (lt positionTransition.stealthBonusChange 0)}}negative{{else}}neutral{{/if}}">
            {{#if (gt positionTransition.stealthBonusChange 0)}}+{{/if}}{{positionTransition.stealthBonusChange}}
          </span>
        </div>
        <div class="impact-row">
          <span class="impact-label">Overall Assessment:</span>
          <span class="impact-value {{positionTransition.transitionType}}">
            {{#if (eq positionTransition.transitionType 'improved')}}
              <i class="fas fa-thumbs-up"></i> Improved
            {{else if (eq positionTransition.transitionType 'worsened')}}
              <i class="fas fa-thumbs-down"></i> Worsened
            {{else}}
              <i class="fas fa-minus"></i> Unchanged
            {{/if}}
          </span>
        </div>
      </div>
    </div>
  {{/if}}

  {{!-- System Status Information --}}
  <div class="system-status-section">
    <h3>
      <i class="fas fa-cogs"></i>
      System Status
    </h3>
    <div class="system-indicators">
      <div class="dual-system-indicator {{#if startPosition.avsEnabled}}{{#if startPosition.autoCoverEnabled}}both-systems{{else}}avs-only{{/if}}{{else}}{{#if startPosition.autoCoverEnabled}}cover-only{{else}}no-systems{{/if}}{{/if}}">
        <span class="system-label">AVS:</span>
        <i class="system-status-icon {{#if startPosition.avsEnabled}}active fas fa-check{{else}}inactive fas fa-times{{/if}}"></i>
        <span class="system-label">Auto-Cover:</span>
        <i class="system-status-icon {{#if startPosition.autoCoverEnabled}}active fas fa-check{{else}}inactive fas fa-times{{/if}}"></i>
      </div>
      
      {{#if startPosition.systemErrors}}
        <div class="system-errors">
          <h4><i class="fas fa-exclamation-triangle"></i> System Warnings:</h4>
          <ul>
            {{#each startPosition.systemErrors as |error|}}
              <li>{{error}}</li>
            {{/each}}
          </ul>
        </div>
      {{/if}}
    </div>
  </div>

  {{!-- Position Quality Assessment --}}
  <div class="position-quality-section">
    <h3>
      <i class="fas fa-star"></i>
      Data Quality
    </h3>
    <div class="quality-assessment">
      <div class="quality-indicator-large">
        {{{positionQualityIndicator positionQuality}}}
        <span class="quality-label">{{positionQuality}} Quality</span>
      </div>
      <div class="quality-explanation">
        {{positionQualityExplanation}}
      </div>
    </div>
  </div>
</div>
<form class="pf2e-visioner-settings" style="height: 100%; display: flex; flex-direction: column;">
  <section class="pv-settings-hero" style="display:flex; gap:16px; align-items:center; padding:10px 10px 8px; border-bottom: 1px solid var(--color-border-light-primary); background: var(--color-bg-primary, #1e1e1e); flex-shrink: 0;">
    <div class="pv-hero-icon" style="width:42px; height:42px; display:flex; align-items:center; justify-content:center; border-radius:8px; background: rgba(100,150,255,0.12);">
      <i class="fa-solid fa-face-hand-peeking" style="font-size:22px;"></i>
    </div>
    <div class="pv-hero-copy" style="display:flex; flex-direction:column; gap:2px;">
      <div style="font-weight:700; font-size:15px;">PF2E Visioner</div>
      <div style="opacity:0.9;">Configure settings below.</div>
    </div>
  </section>

  <nav class="pv-settings-tabs" style="display:flex; gap:8px; padding:8px 10px 6px; border-bottom:1px solid var(--color-border-light-primary); background: var(--color-bg-primary); flex-shrink: 0;">
    {{#each categories as |cat|}}
      <button type="button" class="tab {{#if cat.active}}active{{/if}}" data-action="switchGroup" data-key="{{cat.key}}" style="padding:6px 10px; border-radius:6px; border:1px solid var(--color-border-light-primary); {{#if cat.active}}background: rgba(100,150,255,0.15); font-weight:700;{{/if}}">{{cat.title}}</button>
    {{/each}}
  </nav>

  <div class="pv-settings-content" style="flex: 1; overflow-y: auto; padding-right: 6px;">
    {{#each groups as |group|}}
      <fieldset style="margin-top:10px; border-radius:8px; padding:8px;">
        <legend style="font-weight:700; letter-spacing:.2px; padding:0 4px;">{{group.title}}</legend>
        {{#each group.items as |item|}}
          {{!-- compute indentation padding based on depth (0 parent, 1 child) --}}
          {{#if (eq item.inputType "checkbox")}}
            <div class="pv-form-row" data-depth="{{item.depth}}" style="--pv-depth: {{item.depth}}; margin-bottom:10px; display:flex; align-items:center; justify-content:space-between; gap:12px;">
              <div style="flex:1 1 auto;">
                <label>{{item.name}}</label>
                {{#if item.hint}}<div class="notes" style="opacity:.8;">{{item.hint}}</div>{{/if}}
              </div>
              <div style="flex:0 0 auto; display:flex; align-items:center;">
                <input type="checkbox" name="settings.{{item.key}}" {{#if item.value}}checked{{/if}} data-tooltip="{{item.hint}}">
              </div>
            </div>
          {{else}}
            <div class="pv-form-row" data-depth="{{item.depth}}" style="--pv-depth: {{item.depth}}; margin-bottom:10px;">
              <label>{{item.name}}</label>
              {{#if item.hint}}<div class="notes" style="opacity:.8;">{{item.hint}}</div>{{/if}}
              {{#if (eq item.inputType "number")}}
                <input type="number" name="settings.{{item.key}}" value="{{item.value}}" min="{{item.min}}" max="{{item.max}}" step="{{item.step}}">
              {{else if (eq item.inputType "select")}}
                <select name="settings.{{item.key}}">
                  {{#each item.choices as |opt|}}
                    <option value="{{opt.value}}" {{#if opt.selected}}selected{{/if}}>{{localize opt.label}}</option>
                  {{/each}}
                </select>
              {{else}}
                <input type="text" name="settings.{{item.key}}" value="{{item.value}}">
              {{/if}}
            </div>
          {{/if}}
        {{/each}}
      </fieldset>
    {{/each}}
  </div>
  
  <footer class="pv-fab-footer" style="flex-shrink: 0; display:flex; justify-content:flex-end; padding: 10px; background: var(--color-bg-primary); border-top: 1px solid var(--color-border-light-primary); pointer-events: none;">
    <button type="button" class="pv-fab-save" data-action="submit" data-tooltip="{{localize "Save"}}" aria-label="{{localize "Save"}}" style="pointer-events: all; width: 46px; height: 46px; border-radius: 50%; background: var(--color-primary-500, #ff8400); color: #fff; border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.25); display:flex; align-items:center; justify-content:center;">
      <i class="fas fa-save"></i>
    </button>
  </footer>
</form>
